<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Index</title>
  <meta name="YixinXue" content="SitePoint">
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
</head>
<body>
	<h1>Welcome</h1>

	<div class="get-info" data-template-chosen="a"></div>
	<button type="button" class="btn-get-info">Lights info</button>
	<button type="button" class="btn-ctl-lights">Control lights</button>
	<button type="button" class="btn-create-user">Create user</button>
<script id="get-info-templ" type="text/template">
		<div class="item">
			{{3.state.on}}
		</div>
	</script>

</body>
<script>
$( document ).ready(function() {
	// Get lights information
	$('.btn-get-info').click(function() {
	  	$.ajax({
		    type:"GET",
		    url:"/get-info",
		    success: function(data) {
		 		console.log("Information recieved!");
			    template = $("#get-info-templ").html();
				var html = Mustache.to_html(template, data);
				$(".get-info").html(html);
		    },
			error: function (xhr, status, error) {
				console.log('Error: ' + error.message);
				$(targetContainer).html('Error: info not received.');
			}
	  	});  
	});

	// Control lights
	$('.btn-ctl-lights').click(function(){
		$.ajax({
			type:"POST",
			url:"/control",
			data:'{"on": "true", "bri": "100"}',
			success: function(data){
				console.log("Command received!");
			},
			error: function (xhr, status, error) {
			    console.log('Error: ' + error.message);
			    $(targetContainer).html('Error: command not received.');
			}
		});
	});

	// Create a new user
	$('.btn-create-user').click(function(){
		$.ajax({
			type:"GET",
			url:"/create-user",
			success: function(data){
				console.log("New user created!");
			},
			error: function (xhr, status, error) {
			    console.log('Error: ' + error.message);
			    $(targetContainer).html('Error: please push physical button first.');
			}
		});
	});
});
</script>
</html>
